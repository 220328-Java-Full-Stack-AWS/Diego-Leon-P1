<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
    <link rel="stylesheet" href="styles.css">
    <title>ERS Registration</title>
</head>

<body>

    <div class="container">
        <h1>Register</h1>

        <form>
            <div class="form-control">
                <input type="text" id="fname" required>
                <label>First Name</label>
            </div>
            <div class="form-control">
                <input type="text" id="lname" required>
                <label>Last Name</label>
            </div>
            <div class="form-control">
                <input type="email" id="email" pattern=".+@revature\.net" size="30" required>
                <label>Enter Your revature.net Email</label>
            </div>
            <div class="form-control">
                <input type="password" id="password" required>
                <label>Password</label>
            </div>
            <input type="submit" class="btn" value=" Register">

        </form>
    </div>




    <script src="./authScript.js"></script>

    <script>
        const form = document.querySelector('form')
        form.onsubmit = (e) => {
            e.preventDefault()
            submitForm()
        }

        async function submitForm() {


            console.log("Submitted Form")
            let newUser = {
                first: document.getElementById("fname").value,
                last: document.getElementById("lname").value,
                email: document.getElementById("email").value,
                password: document.getElementById("password").value,
            }


            console.log(newUser);//fact finding

            //Make our asynchronous API call
            let response = await registerNewUser(newUser);

            response.json().then(data => {
                console.log(data.username);
                let username = data.username;

                // console.log("Response: ", response);//fact finding
                // console.log("Response JSON: ", response.json());//we should delete these later

                if (response.status == 201) {
                    alert("form submitted")
                    let token = response.headers.get("authToken");
                    console.log("authToken received: ", token);//fact finding
                    localStorage.setItem("authToken", token);
                    localStorage.setItem("username", username);

                    //navigate the window to the landing page
                    window.location.href = "../User/userLandingPage.html";


                } else if (response.status == 406) {
                    alert("Email Adress already in use.")
                }
                else {
                    alert("Unable to submit Request!");
                }
            })
        }

    </script>
</body>

</html>